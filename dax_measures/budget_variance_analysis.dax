//budget variance analysis using dax.
//demo for Portland BES financial analyst position

//IMPORTANT: each of these measures need to be added one at a time in Power BI data view

// MEASURE 1: Base measures first
Actual Expenditure = SUM('sample_budget_data'[Actual_Amount])

// MEASURE 2:
Budget Amount = SUM('sample_budget_data'[Budget_Amount])

// MEASURE 3:
Budget Variance = [Actual Expenditure] - [Budgeted Amount]

// MEASURE 4:
Budget Variance % = DIVIDE([Budget Variance], [Budgeted Amount], 0)

// MEASURE 5:
YTD Actual = 
CALCULATE(
    SUM('sample_budget_data'[Actual_Amount]),
    DATESYTD('sample_budget_data'[Transaction_Date])
)

// MEASURE 6:
YTD Budget = 
CALCULATE(
    SUM('sample_budget_data'[Budget_Amount]),
    DATESYTD('sample_budget_data'[Transaction_Date])
)

// MEASURE 7:
Variance Status = 
VAR VariancePercent = [Budget Variance %]
RETURN
    SWITCH(
        TRUE(),
        VariancePercent > 0.1, "ğŸ”´ Over Budget",
        VariancePercent > 0.05, "ğŸŸ¡ Warning",
        VariancePercent < -0.05, "ğŸŸ¢ Under Budget",
        "âœ… On Track"
    )

// MEASURE 8:
Remaining Budget = [YTD Budget] - [YTD Actual]

// MEASURE 9:
Budget Utilization % = DIVIDE([YTD Actual], [YTD Budget], 0)

// MEASURE 10:
Monthly Variance = 
VAR CurrentMonth = 
    CALCULATE(
        SUM('sample_budget_data'[Actual_Amount]),
        MONTH('sample_budget_data'[Transaction_Date]) = MONTH(TODAY())
    )
VAR PreviousMonth = 
    CALCULATE(
        SUM('sample_budget_data'[Actual_Amount]),
        MONTH('sample_budget_data'[Transaction_Date]) = MONTH(TODAY()) - 1
    )
RETURN CurrentMonth - PreviousMonth